<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>FB2 ILLUSTRATOR</title><meta name="keywords" content="FB2, иллюстрация, добавить иллюстрации" />
<meta name="description" content="Это документация по программе, позволющей хранить и добавлчть иллюстрации в электронные файлы формата FB2" />

</head>

<body>
<table width="1033" border="0" align="center" cellpadding="10" cellspacing="10">
  <tr>
    <td width="12">&nbsp;</td>
    <td width="1000" align="center"><h1>FB2 ILLUSTRATOR</h1>
    <h1>Добавление иллюстраций в FB2</h1></td>
    <td width="13">&nbsp;</td>
  </tr>
  <tr>
    <td>&nbsp;</td>
    <td><a name="last_version" id="last_version"></a><a href="https://github.com/maxifly/FB2-illustrator/releases/latest" target="new">Последняя версия</a></td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>&nbsp;</td>
    <td><p><a href="#common_info">Общая информация</a></p>
      <p><a href="#setup">Установка и запуск</a></p>
      <p><a href="#login">Логин в ВКонтакте</a></p>
    <p><a href="#load_to_fb2">Загрузка иллюстраций в файл FB2</a></p>
    <p><a href="#proj_create">Создание проекта</a></p>
    <p>&nbsp;&nbsp;&nbsp;<a href="#proj_edit">Окно редоктирования проекта</a></p>
    <p>&nbsp;&nbsp;&nbsp;<a href="#region_ill">Области описания иллюстрации и шаблонов поиска</a></p>
    <p>&nbsp;&nbsp;&nbsp;<a href="#region_prj">Области описания проекта</a></p>
    <p><a href="#save_prj">Сохранение проекта</a></p>
    <p><a href="#ins_curr">Вставка текущего проекта в книгу</a></p>
    <p><a href="#exp_curr">Экспорт и импорт проекта</a></p>
    <p><a href="#del_prj">Удаление проекта</a></p>
    <p><a href="#stt">Установки</a></p>
    <p><a href="#check_version">Проверка версии программы</a></p>
    <p>&nbsp;</p></td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>&nbsp;</td>
    <td><h2><a name="common_info" id="common_info"></a>Общая информация</h2>
      <p>fb2 illustrator предназначен для добавления иллюстраций в электронную книгу формата fb2.0 в кодировке UTF8.</p>
      <p>Сами иллюстрации хранятся в фотоальбомах социальной сети ВКонтакте как обычные фотографии. В качестве описания этих фотографий сохраняется структурированная информация (в формате JSON), которая содержит данные о том в какую книгу, в какой последовательности и после какого отрывка текста необходимо вставлять иллюстрации. Иллюстрации объеденены в проекты. Для каждого проекта сохраняется специальная фотография, причем само изображение не несет смысловой нагрузки, а важно только описание под этой фотографией, которое хранит данные общие для всего проекта.</p>
      <p>В описании самого фотоальбома так же находится структурированная информация, помечающая альбом, как альбом с иллюстрациями.</p>
      <p>Альбом может принадлежать как группе, так и отдельному пользователю ВКонтакте.</p>
    <p>У одного пользоватля или группы может быть несколько таких альбомов. В одном альбоме может быть несколько проектов, а в одном проекте - несколько иллюстраций. Предельное количество иллюстраций ограничено только техническими ограничениями ВКонтакте.</p></td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>&nbsp;</td>
    <td><h2><a name="setup" id="setup"></a>Установка и запуск</h2>
      <p>Скачайте <a href="#last_version">архив с дистрибутивом</a> <strong>fb2_ill_xxx.xxx.zip</strong> (Исходный код скачивать нет необходимости).</p>
      <p>Распакуйте архив.</p>
      <p>Запустите <strong>fb2_ill.bat</strong> или выполните команду: <strong>java -Dfile.encoding=UTF8 -jar fb2_illustrator.jar</strong><br />
    </p></td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>&nbsp;</td>
    <td><h2><a name="login" id="login"></a>Логин в ВКонтакте</h2>
    <p>Для любых операций, связанных с получением или сохранением иллюстраций в ВКонтакте необходимо предварительно произвести вход в социальную сеть.</p>
    <p><strong>Важно:</strong> ответсвенно заявляю, что fb2 illustrator не хранит и никуда не передает конфиденциальной информации о пользователях и их паролях.</p>
    <p>Для входа в социальную сеть необходимо выбрать пункт меню <strong>&quot;VK\Connect&quot;</strong></p>
    <p>В открывшемся окне необходимо ввести логин и пароль. Если пользователь совершает логин впервые, то откроется диалог с просьбой подтвердить права приложения на некоторые операции над данными (чтение данных пользователя, получение и сохранение фотографий и т.д)</p>
    <p>После логина в этом же окне будет получено подтверждение логина - надпись &quot;Пожалуйста, <strong>не копируйте</strong> данные из адресной строки для сторонних сайтов. Таким образом Вы можете <strong>потерять доступ</strong> к Вашему аккаунту.&quot;<br />
      После чего окно надо будет закрыть вручную (да, я знаю, что это недостаток, но пока я не сделал автоматического закрытия окна).</p>
    <p>Если логин произведен успешно в статусной строке программы будет высвечен логин пользователя.</p>
    <p>При этом, на почту, указанную в аккаунте ВКонтакте, придет сообщение, что в социальную сеть был сделан вход с браузера Safari.</p></td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>&nbsp;</td>
    <td><h2><a name="load_to_fb2" id="load_to_fb2"></a>Загрузка иллюстраций в файл FB2</h2>
    <p>Выберите пункт меню <strong>&quot;Project/Import VK project to book&quot;</strong>.</p>
    <p><img src="images/vk_to_fb2_2.jpg" width="800" height="442" /></p>
    <p>Укажите расположение исходного FB2-файла (1). Файл можно как указать вручную, так и выбрать, используя специальную форму, нажав на кнопку <strong>(...) </strong>рядом с полем.<br />
      В поле &quot;название книги&quot; (2) появится название книги, полученное из FB2-файла. Его можно заменить на свое, набрав вручную, или снова получить их файла, нажав кнопку &quot;Из файла&quot;.<br />
      Укажите расположение и наименование результирующего FB2 (3), или оставьте предложение по умолчанию.</p>
    <p>Выберите тип источника иллюстраций (группа, пользователь или конкретный альбом), затем введите адрес источника (4). Адрес можно не вводить вручную, а выбрать из списка последних использованных адресов. В этом списке так же присутсвуют предустановленные адреса.<strong><br />
      Важно!:</strong> некоторые пользователи или группы &quot;ВКонтакте&quot; имеют красивые (&quot;текстовые&quot;) адреса, но вводить необходимо адрес с числовым идентификатором, который так же есть у каждой группы или пользователя и виден в адрессной строке браузера.</p>
    <p>Нажмите кнопку &quot;Искать&quot; <img src="images/Search.jpg" width="64" height="64" /> или &quot;Сбросить кеши программы и искать&quot; <img src="images/Button_White_Load.jpg" width="64" height="64" /><br />
    </p>
    <p>В поле результатов поиска (5) появится список подходящих под наименование книги проектов. В скобках будет указано количество иллюстраций, входящих в проект.</p>
    <p>Следует выбрать один из проектов и нажать кнопку загрузить.</p>
    <p>Ниже приведен пример полностью заполненной экранной формы</p>
    <p><img src="images/vk_to_fb2_3.jpg" width="800" height="425" /></p>
    <p>&nbsp;</p></td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>&nbsp;</td>
    <td><h2><a name="proj_create" id="proj_create"></a>Создание проекта</h2>
    <p>Выберите пункт меню<strong> &quot;Project/New&quot; </strong>для того, чтобы создать новый проект, или <strong>&quot;Project/Open&quot;</strong>, чтобы открыть ранее сохраненный на диске проект. (Так же, существует возможность экспортировать готовый проект из &quot;ВКонтакте&quot;)</p>
    <h3><a name="proj_edit" id="proj_edit"></a>Окно редоктирования проекта</h3>
    <p><img src="images/prj1.jpg" width="799" height="501" alt="" /></p>
    <p>Окно редактирования проекта разбито на три области;</p>
    <p>Перечень иллюстраций (1) - область, в которой можно добавить или удалить иллюстрации (кнопками + и - ), а так же поменять их порядок</p>
    <p>Описание иллюстрации (2) - область, в которой можно выбрать рисунок и указать подпись под иллюстрацией &quot;по умолчанию&quot;</p>
    <p>Шаблоны поиска (3) - область, в которой необходимо задать один или несколько шаблонов поиска абзаца, после которого необходимо добавить иллюстрацию.</p>
    <h3><a name="region_ill" id="region_ill"></a>Области описания иллюстрации и шаблонов поиска</h3>
    <p>Области описания иллюстрации и шаблонов поиска состоят из следующих элементов:</p>
    <p><img src="images/prj2.jpg" width="800" height="498" /></p>
    <p>&nbsp;</p>
    <p>Собственно сам рисунок (1)<br />
      Подпись под иллюстрацией &quot;по умолчанию&quot; (2)<br />
      Перечень шаблонов поиска абзаца (3). <br />
      Кнопка добавления нового шаблона поиска (5). <br />
      Кнопки удаления и редактирования шаблона поиска (4).</p>
    <p>Для каждой иллюстрации необходимо задать как минимум один шаблон поиска абзаца.<br />
      Шаблон поиска может быть задан как текст, являющийся частью абзаца, так и как регулярное выражение, описывающее абзац. </p>
    <p>Если шаблон задается как текст, то для алгоритма не важно:</p>
    <ul>
      <li> строчными или прописными буквами задан шаблон.</li>
      <li>строчными или прописными буквами написаны эти слова в абзаце</li>
      <li>количество пробелов между словами</li>
      <li>знаки препинания между буквами</li>
      </ul>
    <p>Важен только порядок строк</p>
    <p>Если шаблон задан как регулярное выражение - что учитывать, а что нет - задается самим регулярным выражением.</p>
    <p>Задавая шаблон, можно так же указать подпись под иллюстрацией. Под иллюстрацией будет проставлена та подпись, которая соответсвует тому шаблону, с помощью которого был найден подходящий абзац.</p>
    <p>Если подпись под шаблоном не была указана, то будет использована подпись &quot;по умолчанию&quot;. Если и она была пустой - то иллюстрация будет добавлена в книгу без подписи.</p>
    <p>Порядок следования шаблонов не важен.</p>
    <p>Однако важен порядок следования иллюстраций. По нескольким причинам:</p>
    <ul>
      <li>Если был найден абзац для иллюстрации с номером N, то для иллюстраций с номерами N+1, N+2 и так далее будет произведен поиск среди абзацев, следующих в книге позднее, чем абзац для иллюстрации N</li>
      <li>Если был найден абзац для иллюстраций с номерами N и N+n, а для иллюстраций, стоящих между ними - не найден, то такие иллюстрации все равно попадут в книгу, равномерно распределяясь между иллюстрациями N и N+n</li>
      <li>Если абзац не был найден ни для одной иллюстрации - иллюстрации попадут в книгу равномерно распределяясь по тексту в порядке их следования.</li>
    </ul>
    <p>Для того, чтобы поменять порядок следования иллюстраций, необходимо переместить их с пмощью мыши в перечне иллюстраций.</p>
    <p><strong>Важно!</strong>:  задавая шаблон, необходимо знать, что поиск абзаца производится только среди элементов текста, помеченного в FB2 как <strong>&quot;&lt;p&gt;&quot;</strong> (<a href="http://fictionbook.org/index.php/%D0%AD%D0%BB%D0%B5%D0%BC%D0%B5%D0%BD%D1%82_p">"Элемент P"</a>) и не содержащий &quot;вкраплений&quot;, помеченных другими тегами. То есть, поиск в стихах, заголовках или абзацах, перемежаущих простой текст с курсивом или текстом с явно заданным другим шрифтом (в рамках одного абзаца) - невозможен.</p>
    <h3><a name="region_prj" id="region_prj"></a>Области описания проекта</h3>
    <p>Кроме описания иллюстраций необходимо так же заполнить общую информацию о проекте.</p>
    <p>Для этого необходимо нажать на кнопку <strong>&quot;О проекте&quot;</strong>, находящуюся над перечнем иллюстраций. В этот момент окно принимает следующий вид:</p>
    <p><img src="images/prj3.jpg" width="764" height="465" border=1/></p>
    <p>и будет состоять из следующих областей:</p>
    <p>Уникальный номер проекта (1), отображаемый для информации<br />
      Название книги, для которой предназначен проект (2) и под которым проект будет фигурировать в списке найденных проектов (см. <a href="#load_to_fb2">Вставку иллюстраций в файл FB2</a>)<br />
    Шаблоны, описывающие наименование книги (3)<br />
    Абзац, добавляемый в конец книги (4), в котором может быть указана любая информация на усмотрение автора проекта.</p>
    <p>Шаблоны, описывающие название книги могут быть заданны как в виде текста, так и в виде регулярного выражения и должны представлять из себя название книги целиком.</p>
    <p>&nbsp;</p></td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>&nbsp;</td>
    <td><h2><a name="save_prj" id="save_prj"></a>Сохранение проекта</h2>
    <p>Для сохранения проекта на локальном диске необходимо выбрать пункт меню <strong>&quot;Project/Save&quot;</strong> или <strong>&quot;Project/Save as&quot;</strong>. Во втором случае необходимо будет так же задать имя файла, под которым будет сохранен проект. Проект сохраняется в виде двух объектов:</p>
    <ul>
      <li>Файл с названием проекта и расширением pill</li>
      <li>Папка с названием &lt;Название_проекта&gt;_files</li>
      </ul>
    <p>&nbsp;</p></td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>&nbsp;</td>
    <td><h2><a name="ins_curr" id="ins_curr"></a>Вставка текущего проекта в книгу</h2>
    <p>Для проверки проекта предусмотрена возможност вставки текущего проекта в книгу.</p>
    <p>Перед началом процесса рекомендуется сохранить проект.</p>
    <p>Необходимо выбрать пункт меню &quot;Project/&quot;</p>
    <p>Окно жкспорта содержит поля, аналогичные описываемым в разделе <a href="#load_to_fb2">Вставка иллюстраций в файл FB2</a>.</p>
    <p><img src="images/ins_curr1.jpg" width="800" height="446" /></p>
    <p>Если по каким-то причинам название книги (1) не соответсвует названию книги, указаному в проекте, об этом будет написано в поле &quot;Замечания&quot;(2). Что, однако, не помешает загрузить проект в файл.</p>
    <p><img src="images/ins_curr2.jpg" width="800" height="460" /></p></td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>&nbsp;</td>
    <td><h2><a name="exp_curr" id="exp_curr"></a>Экспорт и импорт проекта</h2>
    <p>Для экспорта текущего проекта в социальную сеть выберете пункт меню <strong>&quot;VK/Export current project&quot;</strong>.</p>
    <p><img src="images/prj_exp.jpg" width="639" height="345" /></p>
    <p>Укажите в какой альбом необходимо произвести экспорт:</p>
    <ul>
      <li>Создать новый альбом у текущего пользователя</li>
      <li>Создать новый альбом в группе</li>
      <li>Экспортировать в существующий альбом пользователя или группы</li>
      </ul>
    <p>При необходимости заполните поле с адресом грппы или адресом существующего альбома.</p>
    <p>Если в альбоме, в который осуществляется экспорт проекта уже есть проект с точно таким же кодом, то старая версия проекта будет удалена.</p>
    <p>Для импорта проекта выберите пункт меню <strong>&quot;VK/Import project&quot;</strong>.</p>
    <p><img src="images/prj_imp.jpg" width="620" height="217" /></p>
    <p>Укажите адрес альбома, из которого необходимо произвети импорт и код проекта.</p>
    <p>Узнать код проекта можно по описанию любой фотографии, входящей в проект. Например по приведенному описанию видно, что код проекта <strong>147836480257745</strong>:</p>
    <p>{<br />
&quot;fb_ill&quot;: 1,<br />
&quot;ill_info&quot;: 1,<br />
<strong>&quot;prj&quot;: &quot;147836480257745&quot;,</strong><br />
&quot;num&quot;: 5,<br />
&quot;dsc&quot;: &quot;&quot;,<br />
&quot;srch&quot;: [<br />
{<br />
&quot;s&quot;: &quot;История викингов кончилась&quot;<br />
}<br />
]<br />
}</p>
    <p>После импорта проект будет открыт как текущий и его можно будет сохранить на диск.</p></td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>&nbsp;</td>
    <td><h2><a name="del_prj" id="del_prj"></a>Удаление проекта</h2>
    <p>Выберите пункт меню <strong>&quot;VK/Delete project&quot;</strong></p>
    <p><img src="images/prj_del.jpg" width="684" height="308" /></p>
    <p>Укажите код проекта, который необходимо удалить (или укажите, что код проекта должен совпадать с текущим, открытым в программе). Укажите адрес альбома из которого надо удалить проект.</p></td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>&nbsp;</td>
    <td><h2><a name="stt" id="stt"></a>Установки</h2>
    <p>Выберите пункт меню <strong>&quot;Help/Settings&quot;</strong></p>
    <p>Можно настроить:</p>
    <ul>
      <li> разрешение электронного устройства, до которого будут масштабироваться изображения перед лобавлением их в файл </li>
      <li>каталог, в котором будут храниться проекты</li>
    </ul>    </td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>&nbsp;</td>
    <td><h2><a name="check_version" id="check_version"></a>Проверка версии программы</h2>
    <p>Выберите пункт меню <strong>&quot;Help/About&quot;</strong></p></td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>&nbsp;</td>
    <td><p>&nbsp;</p></td>
    <td>&nbsp;</td>
  </tr>
</table>
</body>
</html>
